<!-- (C) Copyright 2025, SECO Mind Srl

SPDX-License-Identifier: Apache-2.0 -->

# Astarte device SDK C++: Qt example

This example demonstrates how to integrate the **Astarte device SDK for C++** into a **Qt** application.

## üõ†Ô∏è Requirements

Ensure your development environment meets the following requirements:

- **Qt**: Version 5.15 or later.
- **CMake**: Version 3.19 or later.
- **C++ compiler**: Must support C++20 or later.
- **gRPC**: Version 1.69.0 or later.
- **Astarte device SDK C++**

## ‚öôÔ∏è Building with Qt creator

1. Open **Qt Creator** and select **Open Project**.
2. Navigate to `astarte-device-sdk-cpp/samples/grpc/qt` and open `CMakeLists.txt`.
3. When prompted, configure the project using your preferred kit.
4. Click the **Build** icon (üî®) in the lower-left corner.

The build output will be located in a directory similar to:
```
samples/grpc/qt/build/Desktop_Qt_6_8_1-Debug/
```
(Note: The exact folder name depends on your selected Qt kit.)

To run the application:
```bash
./samples/grpc/qt/build/Desktop_Qt_6_8_1-Debug/app
```

### ‚ö†Ô∏è Qt 5 configuration

If you are building with Qt 5, you must manually disable the `USE_QT6` option:
1. Go to the **Projects** tab in Qt Creator (wrench icon).
2. Select your active Build Kit.
3. Under the **CMake** section, locate the `USE_QT6` key.
4. Set the value to **OFF**.

## üß∞ Building from terminal

### Install System Dependencies (Debian/Ubuntu)

The script uses Conan for dependencies, but some system packages are required. On Debian-based systems, install them using:
```bash
apt install -y libx11-dev libx11-xcb-dev libfontenc-dev libice-dev libsm-dev libxau-dev libxaw7-dev libxcomposite-dev libxdamage-dev libxkbfile-dev libxmu-dev libxmuu-dev libxpm-dev libxres-dev libxtst-dev libxcb-glx0-dev libxcb-xkb-dev libxcb-icccm4-dev libxcb-keysyms1-dev libxcb-randr0-dev libxcb-shape0-dev libxcb-sync-dev libxcb-xfixes0-dev libxcb-xinerama0-dev libxcb-dri3-dev libxcb-dri2-0-dev libxcb-present-dev libxcb-composite0-dev libxcb-ewmh-dev libxcb-res0-dev libxcb-util-dev
```
*If you are missing dependencies, Conan will output the specific missing packages in the build logs.*

### Run the build script

```bash
./build_sample.sh grpc/qt [OPTIONS]
```

### Run the Application

```bash
./samples/grpc/qt/build/app
```

## ‚ö†Ô∏è Troubleshooting

### "main.moc" file not found

If you encounter this error, verify the following:
1. Any class inheriting from `QObject` must include the `Q_OBJECT` macro.
2. `main.cpp` is included in the `CMakeLists.txt` source list.
3. `CMAKE_AUTOMOC` is set to `ON` in your `CMakeLists.txt`.

The `main.moc` file is automatically generated by the Qt Meta-Object Compiler (MOC) during a properly configured build.

### CMake configuration reference

Your `CMakeLists.txt` should link the SDK and enable AUTOMOC as shown below:

```cmake
target_link_libraries(app
    PRIVATE astarte_device_sdk
)

# Add the root SDK directory as subdirectory
add_subdirectory(${CMAKE_CURRENT_SOURCE_DIR}/../.. ${CMAKE_CURRENT_BINARY_DIR}/lib_build)

set(CMAKE_AUTOMOC ON)
```
